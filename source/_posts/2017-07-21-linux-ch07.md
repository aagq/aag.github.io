---
title: 鸟哥的Linux私房菜--Ch07
date: 2017-07-21 19:22:44
tags: linux
---
# Chapter7  Linux文件与目录管理

## 1. 目录与路径

### 1.1 相对路径与绝对路径
	
	绝对路径：一定由根目录/写起
	相对路径：不是由/写起

### 1.2 目录的相关操作

	.     代表此层目录
	..    代表上一层目录
	-     代表前一个工作目录
	～    代表目前使用者身份所在的主文件夹
	～account 代表account这个使用者的主文件夹（account是帐号名称）
	
	cd   变换目录
	pwd  显示当前目录
	mkdir 创建一个新的目录
	rmdir 删除一个空的目录
	rm -r file 删除所有的file目录

### 1.3 关于可执行文件路径的变量：$PATH
	mv /a/file /b  将file移动到b目录下
	echo $PATH 查看path
## 2. 文件与目录管理

### 2.1 文件与目录的检视：ls

	ls -a：查看全部的文件（包括隐藏文件）
	   -d:仅列出目录本身
	   -l:长数据串行出，包括文件的属性与权限

	     蓝色表示目录，白色为一般文件

### 2.2 复制/删除与移动：cp,rm,mv

	cp [-aipr] 来源文件 目标文件
		-a:复制文件与源文件一模一样
		-i:若目标文件存在，在覆盖时会先询问动作的进行
		-p:连同文件的属性一起复制
		-r:递归持续复制，用于目录的复制

	rm 文件或目录
	mv 来源文件 目标文件或更名

	
## 3. 文件内容查阅
	
	cat:从第一行开始显示文件内容
	tac:从最后一行开始显示
	nl:显示的时候，顺便输出行号
	more:一页一页显示文件内容
		空格键：代表向下翻一页
		/str:向下搜索
		:f:显示出文件名和目前显示的行数
		q:离开
		b:往前翻页
	touch:修改文件时间或创建新文件
	ll=ls -l

	文件有三个主要的变动参数：
	
	- modification time(mtime):文件内容发生变化，此时间会变
	- status time(ctime):文件属性或权限发生变化
	- access time(atime):文件内容被读取时

	head:只看头几行
	tail:只看最后几行
	od:以二进制的方式读取文件内容


## 4. 文件与目录的默认权限与隐藏权限

### 4.1 文件默认权限：umask

	umask:目前使用者在创建文件或目录时的权限默认值

      -	查阅umask: 
		1. 直接在终端输入umask，可看到数字形态的权限设置分数（4个数字，第一个是特殊权限用的）
		2. 加入 -S(Symbolic)选项，可看到符号形式的权限

      - 设置umask: umask 002(直接写数字）	
      	umask 的后三位数字显示=默认值需要减去的权限值


默认权限：

	创建文件：默认没有可执行权限，最大为666分，即 -rw-rw-rw-
	创建目录：默认权限均开放，即为777,即 drwxrwxrwx

eg. umask = 022，表示 u=rwx,g=rx,o=rx

	创建文件时：（-rw-rw-rw-) - (-----w--w-) ==>-rw-r--r--
	创建目录时：（drwxrwxrwx) - (-----w--w-) ==>drwxr-xr-x

### 4.2 文件隐藏属性

	chattr	设置文件隐藏属性
	chattr [+-=][ASacdistu] 文件或目录
		+  增加某一个特殊参数，其他原本存在参数不动
		-  移除某一个特殊参数，其他原本存在参数不动
		=  设置一定，且仅有后面接的参数
		A  设置了此属性，文件的atime不会修改。
		S  一般文件是非同步写入磁盘的，如果加上S，当你修改文件时就会同步写入磁盘。
		a  设置此属性后，文件只能增加数据不能删除也不能修改
		c  设置此属性后，会自动地对此文件压缩，在读取时自动解压,但是在存储的时候先压缩再存储。
		d  当dump程序被执行那个的时候，设置此属性文件不会被备份
		i  设置此属性后，文件不能删除或者改名或者写入新增数据
		s  设置此属性后，文件删除后就完全被移除磁盘空间，所以误删了就没法挽回。
		u   与s相反，误删可以找回。

ps

	 a与i的设置最常见，很多设置要root才能进行。


	eg.     touch test
		sudo chattr +i test
		rm test	
		(失败）
		sudo chattr -i test 			

	lsattr 显示文件隐藏属性
	lsattr [-adR] 文件或者目录
		-a 将隐藏文件的属性也显示出来
		-d 如果连接的是目录，仅列出目录本身的属性而非目录内的文件名
		-R 连同子目录的数据也一并列出


### 4.3 文件特殊权限： SUID，SGID，SBIT

- Set UID（s出现在文件拥有者的x权限上）

	- SUID权限只对二进制程序有效
	- 这行者对于给程序需要具有x的可执行权限
	- 本权限仅在执行该程序的过程中有效
	- 执行者将具有该程序拥有这种的权限
	- 对目录无效

- Set GID（s出现在群组的x权限上）

	- SGID对二进制程序有用
	- 可以针对文件或目录来设置
	- 执行者在执行过程中将会获得该程序群组的支持
	- 使用者若对于此目录具有r与x的权限时，该使用者能够进入此目录
	- 使用者在此目录下的有效群组将变成该目录的群组
	- 用途：若使用者在此目录下具有w的权限，则使用者所创建的新文件，该新文件的群组与次目录的群组相同。
	
- Sticky Bit

	- SBIT 只针对目录有效，对文件无效
	- 当使用者对于此目录具有w,x权限，即有写入的权限时。
	- 当使用者在该目录下创建文件或目录时，仅有自己与root才有权力删除。

- SUID/SGID/SBIT权限设定

      - 数字法：
	在三个数字的组合前加一个数字：
	4 --SUID
	2 --SGID
	1 --SBIT

eg. cd /tmp
    touch test
    chmod 4755 test; ls -l test (加入SUID权限）
--  -rwsr-xr-x 1 agq agq 0 Jul 22 18:13 test

    chmod 6755 test; ls -l test (加入SUID，SGID权限）
--  -rwsr-sr-x 1 agq agq 0 Jul 22 18:13 test

    chmod 7666 test; ls -l test (具有空的SUID/SGID）
--  -rwSrwSrwT 1 agq agq 0 Jul 22 18:13 test

注意：最后一个例子出现大写的S，T。原因是user,group,others 都没有x这个可执行标志，所以S，T代表的就是空的。SUID表示该文件在执行的时候，具有文件拥有者的权限，但是文件拥有者都无法执行，其他的当然也就没有，所以是空的。

	- 符号法
	 SUID=u+s
	 SGID=g+s
	 SBIT=o+t
eg.  chmod u=rwxs,go=x test; ls -l test
--  -rws--x--x 1 agq agq 0 Jul 22 18:13 test
     chmod g+s,o+t test; ls -l test
--  -rws--s--t 1 agq agq 0 Jul 22 18:13 test

### 4.4 观察文件类型：file

	file 文件名

## 5. 指令与文件的搜寻

### 5.1 指令文件名的搜索

	which [-a] command
 		-a 将所有由PATH目录中可以找到的指令均列出，而不止第一个被找到的指令名称
注意： which 默认找PATH内所规范的目标

### 5.2 文件文件名的搜索

	- whereis(由一些特定的目录中寻找文件文件名）
		whereis[-bmsu] 文件或目录名
			-l 可以列出whereis 会去查询的几个主要目录
			-b 只查找Binary格式的文件
			-m 执照说明文档manual 路径下的文件
			-s 只找source来源文件
			-u 搜寻不再上述三个项目中的其他特殊文件

	- locate
		locate [-iclSr] keyword
			-i 忽略大小写的差异
			-c 不输出文件名，仅计算找到的文件数
			-l 仅输出几行，例如输出五行 -l 5
			-S 输出locates所使用的数据库文件的相关信息，包括该数据库记录的文件和目录数目等。
			-r 后面可接正则表达式的显示方式

	- updatedb 更新数据库

	- find 
	  find [PATH] [option] [action]
	  - -mtime n: n为数字，表示在n天之前的一天内被改过的文件名称 n天到n+1天
	  - -mtime +n: 列出在n天前被改动的文件名称(不含n天本身）大于等于n天前
	  - -mtime -n:	类出在n天内被改动的文件名称（含n天）小于等于n天内
	  - -newer file: file 为一个存在的文件。列出比file 还要新的文件名称



